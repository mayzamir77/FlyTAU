{% extends "base.html" %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='tables.css') }}">

<div class="container">
    <h2>Flight Summary & Passenger Details</h2>

    {% if error %}
    <div class="error" style="background-color: #fff3cd; color: #856404; padding: 15px; border: 1px solid #ffeeba; border-radius: 8px;">
        <strong>{{error}}</strong><br>
        Please <a href="/login" style="color: #1a73e8; font-weight: bold;">Log in here</a> to continue.
    </div>
    {% endif %}

    <div class="summary-box">
        <h3>Booking Summary</h3>
        <div class="form-grid">
            <div>
                <p><strong>Flight:</strong> {{ session['booking_data']['flight_id'] }}</p>
                <p><strong>Class:</strong> {{ session['booking_data']['class_type'] }}</p>
            </div>
            <div>
                <p><strong>Seats:</strong> {{ seats | join(', ') }}</p>
                <p><strong>Passengers:</strong> {{ session['booking_data']['num_seats'] }}</p>
            </div>
        </div>
        <hr style="border: 0; border-top: 1px solid #e2e8f0; margin: 15px 0;">
        <p class="price-total">Total Amount: ${{ session['booking_data']['total_price'] }}</p>
    </div>

    <form action="/review_order" method="POST">
        <fieldset>
            <legend><h3>Passenger Information</h3></legend>
            <div class="form-grid">

                <div class="form-group">
                    <label>First Name (English):</label>
                    <input type="text" name="first_name"
                           value="{{ session.user_first_name or session['booking_data'].get('first_name', '') }}"
                           pattern="[A-Za-z\s]+" title="English letters only" maxlength="50" autocomplete="off"
                           {% if session.get('user_email') %}readonly{% endif %} required>
                </div>

                <div class="form-group">
                    <label>Last Name (English):</label>
                    <input type="text" name="last_name"
                           value="{{ session.user_last_name or session['booking_data'].get('last_name', '') }}"
                           pattern="[A-Za-z\s]+" title="English letters only" maxlength="50" autocomplete="off"
                           {% if session.get('user_email') %}readonly{% endif %} required>
                </div>

                <div class="form-group">
                    <label>Email Address:</label>
                    <input type="email" name="email"
                           value="{{ session.user_email or session['booking_data'].get('email', '') }}"
                           maxlength="100" autocomplete="off"
                           {% if session.get('user_email') %}readonly{% endif %} required>
                </div>

                <div class="form-group">
                    <label>Passport Number:</label>
                    <input type="text" name="passport"
                           value="{{ session.user_passport or session['booking_data'].get('passport', '') }}"
                           pattern="\d{6,20}" title="Please enter between 6 to 20 digits only"
                           minlength="6" maxlength="20" inputmode="numeric" autocomplete="off"
                           {% if session.get('user_email') %}readonly{% endif %} required>
                </div>

                <div class="form-group">
                    <label>Date of Birth:</label>
                    <input type="date" name="birth_date"
                           value="{{ session.user_birth_date or session['booking_data'].get('birth_date', '') }}"
                           max="{{ today }}" autocomplete="off"
                           {% if session.get('user_email') %}readonly{% endif %} required>
                </div>

                <div class="form-group">
                    <label>Primary Phone Number:</label>
                    <input type="text" name="phones"
                           value="{{ session.user_phones[0] if session.user_phones else session['booking_data'].get('phones', [''])[0] }}"
                           pattern="\d+" title="Please enter digits only"
                           minlength="9" maxlength="15" inputmode="tel" autocomplete="off"
                           {% if session.get('user_email') %}readonly{% endif %} required>
                </div>

                <div class="form-group">
                    <label>Phone Number 2 (Optional):</label>
                    <input type="text" name="phones"
                           value="{{ session.user_phones[1] if session.user_phones|length > 1 else session['booking_data'].get('phones', ['', ''])[1] }}"
                           pattern="\d+" title="Please enter digits only"
                           minlength="9" maxlength="15" inputmode="tel" autocomplete="off"
                           {% if session.get('user_email') %}readonly{% endif %}>
                </div>

                <div class="form-group">
                    <label>Phone Number 3 (Optional):</label>
                    <input type="text" name="phones"
                           value="{{ session.user_phones[2] if session.user_phones|length > 2 else session['booking_data'].get('phones', ['', '', ''])[2] }}"
                           pattern="\d+" title="Please enter digits only"
                           minlength="9" maxlength="15" inputmode="tel" autocomplete="off"
                           {% if session.get('user_email') %}readonly{% endif %}>
                </div>

            </div>
        </fieldset>

        <div style="text-align: center;">
            <input type="submit" value="Confirm & Review Order" class="btn-large">
        </div>
    </form>

    <div style="text-align: center; margin-top: 20px;">
        <a href="/" class="back-link">Cancel and Back to Search</a>
    </div>
</div>
{% endblock %}
